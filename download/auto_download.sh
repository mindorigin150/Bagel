#!/bin/bash

# 脚本功能：自动监控并重启 Hugging Face 模型下载脚本，直到下载成功。

echo "开始自动化下载流程..."
echo "脚本将持续运行，直到 download_model.py 成功退出。"
echo "--------------------------------------------------------"

# 使用一个无限循环来包裹下载命令
while true; do
    # 运行你的 Python 下载脚本
    # 确保你的 conda 环境已经激活，或者在这里指定 python 解释器的完整路径
    # 例如：/home/lixinyuan/.conda/envs/bagel/bin/python download_model.py
    python download_model.py

    # 检查上一条命令（即 python 脚本）的退出码
    # $? 存储了最后执行命令的退出码。0 代表成功，非 0 代表失败。
    if [ $? -eq 0 ]; then
        # 如果退出码为 0，说明下载成功
        echo "========================================================"
        echo "下载成功完成！脚本退出。"
        echo "========================================================"
        break # 跳出 while 循环
    else
        # 如果退出码非 0，说明下载被中断或出错
        echo "--------------------------------------------------------"
        echo "下载进程中断或遇到错误 (退出码: $?)。"
        echo "将在 15 秒后自动重试..."
        echo "--------------------------------------------------------"
        sleep 15 # 等待 15 秒再重试，避免因网络瞬间故障导致频繁重启
    fi
done
